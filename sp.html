<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ranking & Pairplot tá»« CSV</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
  <style>
    body{background:#0b0f14;color:#e8eef5;font-family:sans-serif;margin:0;padding:20px}
    .title{font-size:22px;font-weight:700;margin-bottom:8px}
    .card{background:#111821;padding:16px;border-radius:16px;margin-bottom:20px;border:1px solid #223042}
    input[type=file]{background:#0d141d;color:#e8eef5;padding:6px;border-radius:8px}
    #charts{display:grid;grid-template-columns:1fr;gap:20px}
    #ranking{width:100%;height:600px}
    #pairplot{width:100%;height:800px}
  </style>
</head>
<body>
  <div class="title">ğŸ“Š PhÃ¢n tÃ­ch Feature vs Target</div>
  <div class="card">
    <label><strong>CSV:</strong></label>
    <input type="file" id="csv" accept=".csv" />
  </div>

  <div id="charts">
    <div class="card">
      <h3>Báº£ng xáº¿p háº¡ng Ä‘á»™ tÆ°Æ¡ng quan tuyá»‡t Ä‘á»‘i</h3>
      <div id="ranking"></div>
      <div class="explain">
        ğŸ” <strong>Giáº£i thÃ­ch:</strong><br>
        - Biá»ƒu Ä‘á»“ hiá»ƒn thá»‹ má»©c Ä‘á»™ tÆ°Æ¡ng quan (Pearson) giá»¯a tá»«ng feature vÃ  biáº¿n <code>target</code>.<br>
        - GiÃ¡ trá»‹ cÃ ng gáº§n 1 nghÄ©a lÃ  má»‘i liÃªn há»‡ cÃ ng máº¡nh, gáº§n 0 lÃ  yáº¿u.<br>
        - á» Ä‘Ã¢y ta láº¥y <em>giÃ¡ trá»‹ tuyá»‡t Ä‘á»‘i</em> Ä‘á»ƒ xáº¿p háº¡ng, nÃªn khÃ´ng phÃ¢n biá»‡t tÆ°Æ¡ng quan Ã¢m hay dÆ°Æ¡ng.<br>
        - CÃ¡c feature top Ä‘áº§u cÃ³ tiá»m nÄƒng phÃ¢n biá»‡t rÃµ hÆ¡n giá»¯a target=0 vÃ  target=1.
      </div>
    </div>

    <div class="card">
      <h3>Pairplot top 5 feature vá»›i Target</h3>
      <div id="pairplot"></div>
      <div class="explain">
        ğŸ” <strong>Giáº£i thÃ­ch:</strong><br>
        - Má»—i Ã´ scatter thá»ƒ hiá»‡n má»‘i quan há»‡ giá»¯a 2 feature trong top 5.<br>
        - MÃ u sáº¯c: Ä‘á» = target=1, xanh = target=0.<br>
        - Náº¿u hai nhÃ³m mÃ u phÃ¢n tÃ¡ch rÃµ (Ã­t chá»“ng chÃ©o), feature Ä‘Ã³ cÃ³ Ã­ch trong phÃ¢n loáº¡i.<br>
        - ÄÆ°á»ng chÃ©o chÃ­nh hiá»ƒn thá»‹ phÃ¢n phá»‘i cá»§a tá»«ng feature riÃªng biá»‡t.
      </div>
    </div>
  </div>

<script>
let rows=[];

document.getElementById('csv').addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file) return;
  Papa.parse(file,{
    header:true,dynamicTyping:true,skipEmptyLines:true,
    complete: res=>{
      rows=res.data;
      buildCharts();
    }
  });
});

function buildCharts(){
  if(!rows.length) return;
  const headers=Object.keys(rows[0]);
  if(!headers.includes("target")){alert("CSV cáº§n cÃ³ cá»™t 'target'");return;}
  const features=headers.filter(h=>h!=="target" && typeof rows[0][h]==="number");

  // tÃ­nh correlation vá»›i target
  const corrs=[];
  for(const f of features){
    const xs=[], ys=[];
    for(const r of rows){
      if(Number.isFinite(r[f]) && Number.isFinite(r["target"])){
        xs.push(r[f]); ys.push(r["target"]);
      }
    }
    if(xs.length>1){
      const corr=pearson(xs,ys);
      corrs.push({feature:f, value:Math.abs(corr)});
    }
  }
  corrs.sort((a,b)=>b.value-a.value);

  // bar chart
  Plotly.newPlot("ranking",[{
    x:corrs.map(c=>c.value),
    y:corrs.map(c=>c.feature),
    type:"bar",orientation:"h",
    marker:{color:corrs.map(c=>c.value),colorscale:"Viridis"}
  }],{
    title:"Báº£ng xáº¿p háº¡ng Ä‘á»™ tÆ°Æ¡ng quan cÃ¡c feature vá»›i target",
    xaxis:{title:"Äá»™ tÆ°Æ¡ng quan tuyá»‡t Ä‘á»‘i"},
    yaxis:{title:"Feature"}
  },{responsive:true});

  // láº¥y top 5
  const top5=corrs.slice(0,5).map(c=>c.feature);
  makePairplot(top5);
}

function makePairplot(cols){
  const target=rows.map(r=>r["target"]);
  const colors=target.map(t=> t===1 ? "red" : "blue");

  const data=cols.map(c=>{
    return rows.map(r=>r[c]);
  });

  const trace={
    type:'splom',
    dimensions:cols.map((c,i)=>({label:c,values:data[i]})),
    text: target.map(t=>"target="+t),
    marker:{color:colors,size:6,opacity:0.7}
  };

  Plotly.newPlot('pairplot',[trace],{
    title:"Pairplot top 5 feature vá»›i target",
    height:800
  });
}

// Pearson correlation
function pearson(x,y){
  const n=x.length;
  const meanX=x.reduce((a,b)=>a+b,0)/n;
  const meanY=y.reduce((a,b)=>a+b,0)/n;
  let num=0, den1=0, den2=0;
  for(let i=0;i<n;i++){
    const dx=x[i]-meanX, dy=y[i]-meanY;
    num+=dx*dy; den1+=dx*dx; den2+=dy*dy;
  }
  return num/Math.sqrt(den1*den2);
}
</script>
</body>
</html>
