<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Boxplot t∆∞∆°ng t√°c ‚Äì Upload CSV</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
  <style>
    body{margin:0;font-family:sans-serif;background:#0b0f14;color:#e8eef5}
    .app{max-width:1200px;margin:24px auto;padding:16px}
    .title{font-size:22px;font-weight:700;margin-bottom:8px}
    .sub{color:#9fb0c0;font-size:13px;margin-bottom:16px}
    .card{background:#111821;border:1px solid #223042;border-radius:16px;padding:16px}
    .controls{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:16px}
    .controls .group{display:flex;align-items:center;gap:8px;background:#0f1720;
      border:1px solid #223042;border-radius:12px;padding:8px 12px}
    select,input[type=file]{background:#0d141d;color:#e8eef5;border:1px solid #223042;
      border-radius:10px;padding:6px}
    .btn{cursor:pointer;background:#3b82f6;border:none;color:white;padding:8px 14px;
      border-radius:10px;font-weight:600}
    .panel{margin-top:16px;padding:14px;background:#111821;border:1px solid #223042;border-radius:16px}
    .panel h3{margin-top:0;font-size:16px}
    #plot{width:100%;height:600px}
  </style>
</head>
<body>
<div class="app">
  <div class="title">üìä Boxplot ph√¢n ph·ªëi feature theo Target</div>
  <div class="sub">T·∫£i CSV c√≥ header. Ch·ªçn target (0/1) v√† feature numeric ƒë·ªÉ xem boxplot.</div>

  <div class="card">
    <div class="controls">
      <div class="group">
        <label><strong>CSV:</strong></label>
        <input id="csv" type="file" accept=".csv" />
      </div>
      <div class="group">
        <label>Target:</label>
        <select id="target"><option value="">‚Äî ch·ªçn ‚Äî</option></select>
      </div>
      <div class="group">
        <label>Feature:</label>
        <select id="feature"><option value="">‚Äî ch·ªçn ‚Äî</option></select>
      </div>
      <button id="btnExport" class="btn" disabled>T·∫£i PNG</button>
    </div>
    <div id="plot"></div>
  </div>

  <div class="panel">
    <h3>C√°ch ƒë·ªçc boxplot</h3>
    <p>‚Ä¢ ƒê∆∞·ªùng ngang gi·ªØa h·ªôp = median (trung v·ªã).</p>
    <p>‚Ä¢ M√©p h·ªôp = Q1, Q3 (t·ª© ph√¢n v·ªã 25% v√† 75%).</p>
    <p>‚Ä¢ R√¢u = ph·∫°m vi d·ªØ li·ªáu kh√¥ng ngo·∫°i l·ªá.</p>
    <p>‚Ä¢ ƒêi·ªÉm r·ªùi r·∫°c = outlier.</p>
    <p>So s√°nh gi·ªØa c√°c nh√≥m target cho th·∫•y ph√¢n ph·ªëi c·ªßa feature kh√°c nhau th·∫ø n√†o.</p>
  </div>
</div>

<script>
let rows=[], headers=[];
const fileInput=document.getElementById('csv');
const targetSel=document.getElementById('target');
const featureSel=document.getElementById('feature');
const btnExport=document.getElementById('btnExport');

fileInput.addEventListener('change', e=>{
  const file=e.target.files[0];
  if(!file) return;
  Papa.parse(file,{
    header:true,
    dynamicTyping:true,
    skipEmptyLines:true,
    complete: res=>{
      rows=res.data;
      headers=res.meta.fields;
      // populate select
      targetSel.innerHTML='<option value="">‚Äî ch·ªçn ‚Äî</option>'+headers.map(h=>`<option>${h}</option>`).join('');
      featureSel.innerHTML='<option value="">‚Äî ch·ªçn ‚Äî</option>'+headers.map(h=>`<option>${h}</option>`).join('');
    }
  });
});

function draw(){
  const target=targetSel.value, feat=featureSel.value;
  if(!target||!feat) return;
  const groups={};
  for(const r of rows){
    if(r[target]===undefined||r[feat]===undefined) continue;
    const t=r[target], v=parseFloat(r[feat]);
    if(!Number.isFinite(v)) continue;
    if(!groups[t]) groups[t]=[];
    groups[t].push(v);
  }
  const data=Object.keys(groups).map(k=>({
    y:groups[k], type:'box', name:`${target}=${k}`,
    boxmean:'sd', marker:{color:'#3b82f6'}
  }));
  Plotly.newPlot('plot',data,{
    paper_bgcolor:'#111821',plot_bgcolor:'#111821',
    font:{color:'#e8eef5'},
    yaxis:{title:feat},xaxis:{title:target}
  });
  btnExport.disabled=false;
}

targetSel.addEventListener('change',draw);
featureSel.addEventListener('change',draw);

btnExport.addEventListener('click',()=>{
  Plotly.downloadImage('plot',{format:'png',filename:'boxplot'});
});
</script>
</body>
</html>